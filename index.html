<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë„¤ì´ë²„ ìŠ¤íƒ€ì¼ ì‚¬ë‹¤ë¦¬ ê²Œì„</title>
  <style>
    :root { 
      --naver-green: #03c75a;
      --bg-gray: #f4f6f8;
      --line-color: #ced4da;
      --text-dark: #333;
    }
    body { 
      margin:0; font-family: 'Malgun Gothic', sans-serif; background: var(--bg-gray); color: var(--text-dark);
      display: flex; flex-direction: column; align-items: center;
    }

    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .game-container { 
      width: 100%; max-width: 800px; background: #fff; padding: 40px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 50px; border-radius: 8px;
    }

    /* í”„ë¦¬ì…‹ ë²„íŠ¼ (ë„¤ì´ë²„ ìƒë‹¨ íƒ­ ìŠ¤íƒ€ì¼) */
    .preset-btns { display: flex; gap: 8px; justify-content: center; margin-bottom: 30px; }
    .img-btn {
      min-width: 130px; height: 45px; border: 1px solid #ddd; background: #fff;
      cursor: pointer; border-radius: 22px; font-weight: bold; font-size: 14px;
      background-size: cover; background-position: center; transition: all 0.2s;
    }
    .img-btn:hover { border-color: var(--naver-green); color: var(--naver-green); }

    /* ì‚¬ë‹¤ë¦¬ íŒ ë ˆì´ì•„ì›ƒ */
    .ladder-board { position: relative; display: flex; flex-direction: column; align-items: center; }

    /* ì…ë ¥ì°½ ê·¸ë¦¬ë“œ - ìº”ë²„ìŠ¤ ë„ˆë¹„ì™€ ì™„ë²½ ì¼ì¹˜ */
    .input-row { 
      display: flex; width: 100%; justify-content: space-between; margin-bottom: 10px;
    }
    .input-box { flex: 1; display: flex; justify-content: center; }
    .input-box input {
      width: 80%; padding: 10px 0; border: 1px solid #e5e5e5; border-radius: 4px;
      text-align: center; font-size: 14px; outline: none; transition: border 0.2s;
    }
    .input-box input:focus { border-color: var(--naver-green); }

    canvas { background: #fff; cursor: pointer; }

    /* ì´ë™í•˜ëŠ” ë§ (2/3 í¬ê¸°) */
    #playerPiece {
      position: absolute; width: 30px; height: 30px;
      background-image: url('https://cdn-icons-png.flaticon.com/128/802/802340.png');
      background-size: contain; background-repeat: no-repeat;
      display: none; z-index: 10; pointer-events: none;
      transform: translate(-50%, -100%);
    }

    /* í•˜ë‹¨ ë²„íŠ¼ */
    .action-btns { margin-top: 30px; }
    .main-action {
      width: 200px; height: 55px; background: var(--naver-green); color: #fff;
      border: none; border-radius: 4px; font-size: 18px; font-weight: bold; cursor: pointer;
    }
    .main-action:active { background: #02a34a; }

  </style>
</head>
<body>

<div class="game-container">
  <div class="preset-btns">
    <button class="img-btn" onclick="applyPreset('ğŸ˜ˆ 835 ğŸ˜ˆ', 5)">ğŸ˜ˆ 835 ğŸ˜ˆ</button>
    <button class="img-btn" onclick="applyPreset('ğŸ‘¼ 1435 ğŸ‘¼', 5)">ğŸ‘¼ 1435 ğŸ‘¼</button>
    <button class="img-btn" onclick="applyPreset('ğŸ‘ 3535 ğŸ‘', 4)">ğŸ‘ 3535 ğŸ‘</button>
    <button class="img-btn" onclick="applyPreset('â¤ï¸ 18335 â¤ï¸', 3)">â¤ï¸ 18335 â¤ï¸</button>
  </div>

  <div class="ladder-board">
    <div id="topRow" class="input-row"></div>

    <div style="position: relative;">
      <div id="playerPiece"></div>
      <canvas id="ladderCanvas" width="700" height="450"></canvas>
    </div>

    <div id="bottomRow" class="input-row" style="margin-top: 10px;"></div>
  </div>

  <div class="action-btns">
    <button class="main-action img-btn" onclick="generateLadder()">ì‚¬ë‹¤ë¦¬ ì‹œì‘</button>
  </div>
</div>

<script>
  const canvas = document.getElementById('ladderCanvas');
  const ctx = canvas.getContext('2d');
  const piece = document.getElementById('playerPiece');
  let state = { n: 5, h: 12, links: [], isMoving: false };

  // 1. ì„  ê°„ê²© ê³„ì‚° (ë„¤ì´ë²„ì²˜ëŸ¼ í•­ëª© ì¤‘ì•™ì— ë§ì¶¤)
  function getX(idx) {
    const gap = canvas.width / state.n;
    return (gap * idx) + (gap / 2);
  }

  // 2. í”„ë¦¬ì…‹ ì ìš© (ë„¤ì´ë²„ ìŠ¤íƒ€ì¼ ì…ë ¥ ì¹¸ ìƒì„±)
  function applyPreset(name, count) {
    state.n = count;
    const topRow = document.getElementById('topRow');
    const bottomRow = document.getElementById('bottomRow');
    
    topRow.innerHTML = ''; bottomRow.innerHTML = '';
    for(let i=0; i<count; i++) {
      topRow.innerHTML += `<div class="input-box"><input type="text" value="${i+1}" id="t${i}" onclick="startLadder(${i})"></div>`;
      bottomRow.innerHTML += `<div class="input-box"><input type="text" value="ê½" id="b${i}"></div>`;
    }
    
    generateLadder(false); // ì„  ë¯¸ë¦¬ ê·¸ë¦¬ê¸°
  }

  // 3. ì‚¬ë‹¤ë¦¬ ìƒì„± ë¡œì§
  function generateLadder(animate = true) {
    if(state.isMoving) return;
    
    state.links = Array.from({length: state.h}, () => []);
    for(let y=0; y<state.h; y++) {
      for(let x=0; x<state.n-1; x++) {
        if(Math.random() < 0.5) {
          state.links[y].push(x);
          x++; // ê°€ë¡œì„  ê²¹ì¹¨ ë°©ì§€
        }
      }
    }
    draw();
  }

  // 4. í™”ë©´ ê·¸ë¦¬ê¸°
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const h = canvas.height;
    const dy = h / (state.h + 1);

    // ì„¸ë¡œì„  (íšŒìƒ‰)
    ctx.strokeStyle = '#ddd'; ctx.lineWidth = 2;
    for(let i=0; i<state.n; i++) {
      ctx.beginPath(); ctx.moveTo(getX(i), 0); ctx.lineTo(getX(i), h); ctx.stroke();
    }

    // ê°€ë¡œì„  (íšŒìƒ‰)
    state.links.forEach((row, y) => {
      const yy = (y + 1) * dy;
      row.forEach(x => {
        ctx.beginPath(); ctx.moveTo(getX(x), yy); ctx.lineTo(getX(x+1), yy); ctx.stroke();
      });
    });
  }

  // 5. ì‚¬ë‹¤ë¦¬ íƒ€ê¸° ì• ë‹ˆë©”ì´ì…˜
  async function startLadder(idx) {
    if(state.isMoving || state.links.length === 0) return;
    state.isMoving = true;
    
    const dy = canvas.height / (state.h + 1);
    let curCol = idx;
    let curX = getX(curCol), curY = 0;

    piece.style.display = 'block';
    updatePiece(curX, curY);

    // ê²½ë¡œ ì¶”ì  ë° ì´ë™
    for(let y=0; y<state.h; y++) {
      const nextY = (y + 1) * dy;
      await movePiece(curX, nextY); curY = nextY;

      let nextX = curX;
      if(state.links[y].includes(curCol)) { curCol++; nextX = getX(curCol); }
      else if(state.links[y].includes(curCol-1)) { curCol--; nextX = getX(curCol); }
      
      if(nextX !== curX) { await movePiece(nextX, curY); curX = nextX; }
    }
    
    await movePiece(curX, canvas.height);
    
    // ê²°ê³¼ ê°•ì¡°
    document.getElementById(`b${curCol}`).style.borderColor = 'var(--naver-green)';
    document.getElementById(`b${curCol}`).style.background = '#eafff2';
    
    state.isMoving = false;
  }

  function updatePiece(x, y) {
    piece.style.left = x + 'px';
    piece.style.top = y + 'px';
  }

  function movePiece(tx, ty) {
    return new Promise(res => {
      const sx = parseFloat(piece.style.left), sy = parseFloat(piece.style.top);
      const start = performance.now();
      function step(now) {
        const p = Math.min((now - start) / 120, 1); // ë„¤ì´ë²„ìŠ¤ëŸ¬ìš´ ì†ë„
        updatePiece(sx + (tx-sx)*p, sy + (ty-sy)*p);
        if(p < 1) requestAnimationFrame(step); else res();
      }
      requestAnimationFrame(step);
    });
  }

  window.onload = () => applyPreset('835', 5);
</script>
</body>
</html>
